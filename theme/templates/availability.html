{% extends "base.html" %}
{% block content %}
<div class="px-32 py-8">

  <div class="bg-gray-700 text-white p-6 rounded-lg shadow-lg w-[700px] mx-auto">
    <h2 class="text-2xl font-bold mb-6">Your Weekly Availability</h2>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" name="add_availability"
              class="bg-yellow-500 hover:bg-green-500 text-black text-xl px-6 py-3 rounded-lg shadow-md">
        Add Availability
      </button>
    </form>
  </div>

  <div class="bg-red-700 text-white p-6 rounded-lg shadow-lg w-[700px] mx-auto mt-8">
    <h2 class="text-2xl font-bold mb-6">Add Day Off</h2>
    <form method="post">
      {% csrf_token %}
      {{ day_off_form.as_p }}
      <button type="submit" name="add_day_off"
              class="bg-yellow-500 hover:bg-red-500 text-black text-xl px-6 py-3 rounded-lg shadow-md">
        Add Day Off
      </button>
    </form>
  </div>

  <!-- Availability grouped by month -->
  <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg w-[900px] mx-auto mt-8">
    <h3 class="text-xl font-semibold mb-4">Current Weekly Availability:</h3>

    {% regroup merged_availabilities.items by day|date:"F Y" as month_list %}
    {% for month, entries in month_list %}
      <div class="mb-6">
        <h4 class="text-lg font-bold text-yellow-400 border-b border-gray-600 pb-1 mb-3">
          {{ month }}
        </h4>
        <table class="w-full text-sm border-collapse">
          <thead>
            <tr class="bg-gray-700">
              <th class="p-2 text-left">Date</th>
              <th class="p-2 text-left">Available Hours</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
              <tr class="border-b border-gray-700 hover:bg-gray-700/40">
                <td class="p-2">{{ entry.0|date:"D, d M Y" }}</td>
                <td class="p-2">
                  {% for start, end in entry.1 %}
                    <span class="bg-green-600 px-2 py-1 rounded-md text-xs">
                      {{ start|time:"H:i" }} - {{ end|time:"H:i" }}
                    </span>
                    {% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% empty %}
      <p>No availability set.</p>
    {% endfor %}
  </div>

  <div class="bg-gray-900 text-white p-6 rounded-lg shadow-lg w-[700px] mx-auto mt-8">
    <h3 class="text-xl font-semibold mb-4">Upcoming Days Off:</h3>
      <ul class="list-disc pl-6">
        {% for d in days_off %}
          <li>{{ d.date|date:"D, d M Y" }}</li>
        {% empty %}
          <li>No days off set.</li>
        {% endfor %}
      </ul>
  </div>

</div>
{% endblock %}
