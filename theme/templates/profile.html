{% extends "base.html" %}
{% load custom_tags %}

{% block content %}
<div class="bg-gray-900 text-white p-6">
  <h2 class="text-2xl underline mb-4">My profile</h2>

  {% for label, field in editable_fields %}
    <div class="mb-4" id="field-{{ field }}">
      <div class="flex items-center justify-between">
        <p class="mb-1 font-semibold">{{ label }}:
          {% if field == 'get_role_display' %}
            {{ user.get_role_display }}
          {% elif field == 'password' %}
            ********
          {% else %}
            <span class="field-value">{{ user|attr:field }}</span>
          {% endif %}
        </p>

        {% if field != 'get_role_display' %}
          <button class="edit-btn bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded" data-field="{{ field }}">
            Edytuj
          </button>
        {% endif %}
      </div>

      <form method="post" class="edit-form hidden mt-2" data-field="{{ field }}">
        {% csrf_token %}
        <input type="hidden" name="field" value="{{ field }}">

        {% if field == 'password' %}
          <input type="password" name="value" class="text-black px-2 py-1 rounded" placeholder="Nowe hasÅ‚o">
        {% elif field == 'email' %}
          <input type="email" name="value" class="text-black px-2 py-1 rounded" value="{{ user.email }}">
        {% else %}
          <input type="text" name="value" class="text-black px-2 py-1 rounded" value="{{ user|attr:field }}">
        {% endif %}

        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded ml-2">OK</button>
        <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded ml-1">Anuluj</button>
      </form>
    </div>
  {% endfor %}
</div>

<script>
  document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', () => {
      const field = button.getAttribute('data-field');
      const div = document.querySelector(`#field-${field}`);
      div.querySelector('.edit-form').classList.remove('hidden');
      button.classList.add('hidden');
      const span = div.querySelector('.field-value');
      if (span) span.classList.add('hidden');
    });
  });

  document.querySelectorAll('.cancel-btn').forEach(button => {
    button.addEventListener('click', () => {
      const form = button.closest('.edit-form');
      const field = form.getAttribute('data-field');
      const div = document.querySelector(`#field-${field}`);
      form.classList.add('hidden');
      div.querySelector('.edit-btn').classList.remove('hidden');
      const span = div.querySelector('.field-value');
      if (span) span.classList.remove('hidden');
    });
  });
</script>
{% endblock %}
